import{w as a}from"./websocket.ec069327.js";import{i as e,l as s}from"./index.41483e92.js";import{u as t,s as o,L as n}from"./index.31646587.js";import{s as l,b as i,w as c,j as d,a as u,d as m,n as r,r as v,E as p,o as h,c as f,O as g,P as y,q as b,B as w,U as I,R as _,F as S,Z as k,x as N,u as T,_ as x,k as j,X as B,Y as O}from"./vue.9ae86005.js";const $=a=>(B("data-v-66f66573"),a=a(),O(),a),E={class:"chat-main"},J={class:"close-down"},L={class:"item"},U={class:"item-avatar"},V={class:"item-name"},C=$((()=>y("em",null,":",-1))),F={class:"item-cont"},R={class:"item-avatar"},q={type:3},z={class:"item-name"},A=$((()=>y("em",null,":",-1))),D={class:"item-cont"},H={class:"chat-main__form"},M=$((()=>y("button",{"native-type":"submit",hidden:""},null,-1))),P={class:"action"};var X=l({props:{show:Boolean},emits:["update:show"],setup(l,{emit:B}){const O=l,{t:$}=t(),X=i({get:()=>O.show,set:a=>B("update:show",a)}),Y=i((()=>o.state.app.showFixedBet)),Z=i((()=>o.state.user.userInfo)),G=i((()=>o.state.match.matchInfo)),K=i((()=>{const{isSend:a}=aa.value;return!n()||0==a})),Q=i((()=>{const{isSend:a}=aa.value;return 0==a||!ca.value})),W=i((()=>{const{isSend:a,bettingTotal:e}=aa.value;return n()?0==a?$("live.needBet",{num:e}):$("live.chatTip")+"...":$("live.needLogin")}));c((()=>G.value),(()=>{ea()})),d((()=>{})),u((()=>{a.disconnect()}));const aa=m({}),ea=async()=>{const a={gidm:G.value.gidm,systemId:G.value.systemId,anchorId:void 0,version:"3.9.0"},s=await e(a);200==s.code&&(aa.value=s.data||{},sa(),ta())},sa=async()=>{const{roomNo:a,channelType:e}=aa.value,t={roomNo:a,page:1,pageSize:20,channelType:e},o=await s(t),n=(o.extra||{}).messageList||[];if(200==o.code){const a=[];n.forEach((e=>{if(e.msgType&&2==+e.msgType&&e.content){(JSON.parse(e.content||"").bettingData||[]).forEach((e=>{a.push(e.gidm)}))}})),na(n)}},ta=async()=>{const{roomNo:e}=aa.value,s=`/topic/1/${e}`;a.subscribe(s,(a=>{const e=JSON.parse(a.body);if(e&&1e3===e.action){const[a]=e.data;na(a)}}))},oa=m([]),na=a=>{a instanceof Array?oa.value=a.reverse().concat(oa.value):oa.value.push(a),ia()},la=m(null),ia=()=>{const a=la.value||{};r((()=>{a.scrollTop=a&&a.scrollHeight}))},ca=m(),da=()=>{const e=ca.value,{roomNo:s}=aa.value,{playerId:t,teamId:o}=Z.value,n={token:"1",msgType:"1",roomNo:s,content:e,playerId:t,teamId:o};a.send("/chat/sendMsg",JSON.stringify(n)),ca.value=""};return(a,e)=>{const s=v("SvgIcon"),t=v("van-field"),o=v("van-form"),n=v("van-button"),l=v("van-popup"),i=p("img");return h(),f(l,{class:x(["chat",{"has-bet":T(Y)}]),show:T(X),"onUpdate:show":e[2]||(e[2]=a=>j(X)?X.value=a:null),position:"bottom",overlay:!1,"close-on-click-overlay":!0,round:""},{default:g((()=>[y("div",E,[y("div",J,[y("img",{src:"/assets/down_round.edea70a6.png",onClick:e[0]||(e[0]=a=>X.value=!1)})]),y("div",{class:"chat-main__wrapper",ref_key:"chatRef",ref:la},[y("div",L,[y("div",U,[b(s,{name:"bot"})]),y("div",V,[w(I(a.$t("live.aiBot")),1),C]),y("div",F,I(a.$t("live.chatSys")),1)]),(h(!0),_(S,null,k(oa.value,(a=>(h(),_("div",{class:"item",key:a.msgId},[y("div",R,[N(y("img",q,null,512),[[i,a.headImg]])]),y("div",z,[w(I(a.nickName),1),A]),y("div",D,I(a.content),1)])))),128))],512),y("div",H,[b(o,{onSubmit:da,"submit-on-enter":""},{default:g((()=>[b(t,{modelValue:ca.value,"onUpdate:modelValue":e[1]||(e[1]=a=>ca.value=a),autocomplete:"off",placeholder:T(W),disabled:T(K),maxlength:50},null,8,["modelValue","placeholder","disabled"]),M])),_:1}),y("div",P,[b(n,{onClick:da,disabled:T(Q)},{default:g((()=>[w(I(a.$t("live.send")),1)])),_:1},8,["disabled"])])])])])),_:1},8,["class","show"])}}});X.__scopeId="data-v-66f66573";export{X as default};
